<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>文章索引</title>
</head>
<body>
  <h1>文章索引</h1>
  <div id="post-list"></div>
  <div id="error" style="color: red;"></div>
  <script>
    const repo = 'forestbird/forestbird.github.io';
    const branch = 'main';
    const dir = '_posts';
    const api = `https://api.github.com/repos/${repo}/contents/${dir}?ref=${branch}`;

    fetch(api)
      .then(res => {
        if (!res.ok) throw new Error('API 请求失败: ' + res.statusText);
        return res.json();
      })
      .then(files => {
        if (!Array.isArray(files)) throw new Error('API 响应不是文件数组');
        const mdFiles = files.filter(f => f.name.endsWith('.md'));
        const list = document.getElementById('post-list');
        if (mdFiles.length === 0) {
          list.textContent = '没有文章。';
          return;
        }
        mdFiles.forEach(file => {
          const a = document.createElement('a');
          // 去掉.md后缀显示
          let title = file.name.replace(/\.md$/, '');
          // 如果文件名类似"2024-08-09-xxx.md"，可以再去掉日期部分
          title = title.replace(/^\d{4}-\d{2}-\d{2}-/, '');
          a.textContent = title;
          // 跳转到 md_viewer.html，并带上 md 文件的 raw 下载地址
          a.href = `md_viewer.html?url=${encodeURIComponent(file.download_url)}&title=${encodeURIComponent(title)}`;
          a.target = '_blank';
          list.appendChild(a);
          list.appendChild(document.createElement('br'));
        });
      })
      .catch(err => {
        document.getElementById('error').textContent = err.message;
      });
  </script>
</body>
</html>
