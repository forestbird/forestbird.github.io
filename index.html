<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Markdown 日志索引</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <h1>Markdown 日志索引</h1>
  <div id="md-list"></div>
  <hr>
  <div id="md-content"></div>
  <div id="error" style="color: red;"></div>
  <script>
    const repo = 'forestbird/forestbird.github.io'; // 你的仓库名
    const branch = 'main'; // 如果你的主分支不是 main，请改为 master
    const dir = '_posts';   // 目录改为 _posts
    const api = `https://api.github.com/repos/${repo}/contents/${dir}?ref=${branch}`;

    fetch(api)
      .then(res => {
        if (!res.ok) {
          document.getElementById('error').textContent = `API 请求失败: ${res.status} ${res.statusText}`;
          throw new Error(res.statusText);
        }
        return res.json()
      })
      .then(files => {
        if (!Array.isArray(files)) {
          document.getElementById('error').textContent = 'API 响应不是文件数组，可能目录不存在或拼写错误。';
          return;
        }
        const mdFiles = files
          .filter(f => f.name.endsWith('.md'))
          .sort((a, b) => a.name.localeCompare(b.name));
        const list = document.getElementById('md-list');
        if (mdFiles.length === 0) {
          list.textContent = '没有找到任何 .md 日志文件。';
          return;
        }
        mdFiles.forEach(file => {
          const a = document.createElement('a');
          a.href = '#';
          a.textContent = file.name;
          a.onclick = () => { loadMd(file.download_url); return false; };
          list.appendChild(a);
          list.appendChild(document.createElement('br'));
        });
        loadMd(mdFiles[mdFiles.length - 1].download_url); // 默认显示最新
      })
      .catch(err => {
        document.getElementById('error').textContent = '无法获取日志列表: ' + err.message;
      });

    function loadMd(url) {
      fetch(url)
        .then(res => res.text())
        .then(md => {
          document.getElementById('md-content').innerHTML = marked.parse(md);
        })
        .catch(err => {
          document.getElementById('md-content').textContent = '无法加载日志内容: ' + err.message;
        });
    }
  </script>
</body>
</html>
