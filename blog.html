<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>森林鸟 · bird.work</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="森林鸟（forestbird，赵伟峰）的博客，域名 bird.work | 3.1415926.xyz | zhaoweifeng.cn，记录代码、生活、思考。">
  <meta name="keywords" content="森林鸟,forestbird,赵伟峰,bird.work,3.1415926.xyz,zhaoweifeng.cn,博客,随笔">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@600&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
  <style>
    /* [原有CSS内容保持不变] */
    /* 新增移动端优化样式 */
    @media (max-width: 600px) {
      .china-jie {
        left: -28px;
        top: 18px;
        width: 24px;
        height: 24px;
      }
      .meta {
        gap: 8px;
        font-size: 0.85rem;
      }
      .tag, .category {
        padding: 1px 8px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
  <!-- [原有HTML结构保持不变] -->
  <script>
    // 更新后的初始化函数
    async function init() {
      showLoading();
      try {
        let posts = await fetch(postsJsonUrl).then(res => {
          if (!res.ok) throw new Error('Posts.json not found');
          return res.json();
        });
        
        // 确保所有文章都有标题
        posts = posts.map(post => ({
          title: post.title || formatFilenameToTitle(post.filename),
          date: post.date || '',
          author: post.author || '森林鸟',
          categories: post.categories || [],
          tags: post.tags || [],
          url: post.url || `https://raw.githubusercontent.com/${repo}/main/_posts/${encodeURIComponent(post.filename)}`,
          filename: post.filename
        }));
        
        posts.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
        renderPosts(posts, 1);
      } catch (err) {
        console.error('Using GitHub API as fallback:', err);
        loadFromGitHubAPI();
      }
    }

    function formatFilenameToTitle(filename) {
      return filename
        .replace(/\.md$/, '')
        .replace(/^\d{4}-\d{2}-\d{2}-/, '')
        .replace(/-/g, ' ')
        .replace(/\b\w/g, l => l.toUpperCase());
    }

    async function loadFromGitHubAPI() {
      try {
        const files = await fetch(api).then(res => res.json());
        const mdFiles = files.filter(f => f.name.endsWith('.md'));
        const posts = await Promise.all(mdFiles.map(async file => {
          try {
            const text = await fetch(file.download_url).then(r => r.text());
            const fm = parseYAMLFrontmatter(text) || {};
            return {
              title: fm.title || formatFilenameToTitle(file.name),
              date: fm.date || '',
              author: fm.author || '森林鸟',
              categories: fm.categories || [],
              tags: fm.tags || [],
              url: file.download_url,
              filename: file.name
            };
          } catch (err) {
            console.error('Error processing file:', file.name, err);
            return {
              title: formatFilenameToTitle(file.name),
              date: '',
              author: '森林鸟',
              categories: [],
              tags: [],
              url: file.download_url,
              filename: file.name
            };
          }
        }));
        
        posts.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
        renderPosts(posts, 1);
      } catch (err) {
        postList.innerHTML = '<div class="error">无法加载文章列表，请检查网络连接</div>';
        console.error('Failed to load posts:', err);
      }
    }

    // [其余原有JavaScript代码保持不变]
  </script>
</body>
</html>
