---
id: 415
title: '缩短IIS应用池回收时间,减少IIS假死'
date: '2010-03-23T01:04:58+08:00'
author: forestbird
layout: post
guid: 'https://bird.work/?p=415'
permalink: /2010/03/23/20100322565-2/
categories:
    - log
tags:
    - IIS假死
    - windows2003
    - 本地访问正常
    - 远程不能访问
---

 IIS日志：

<div>应用程序:ISAPI ‘C:\WINDOWS\system32\inetsrv\asp.dll’ 报告它自身有问题，原因如下: ‘ASP 不正常，因为执行请求的 100% 被挂起，而且请求队列已经使用了 0%。’。 </div><div> </div><div>关于server 2003+IIS6 出现 ‘ASP 不正常，因为执行请求的 100% 被挂起 </div><div> </div><div>现像如下: </div><div> </div><div>站点无法打开,或者打开很慢.HTML可以打开.重新启动或者回收应用程序池可恢复.但过一段时间又会出现 </div><div> </div><div>日志里会有: </div><div> </div><div>ISAPI ‘C:\WINDOWS\system32\inetsrv\asp.dll’ reported itself as unhealthy for the following reason: ‘ASP unhealthy because 100% of executing requests are hung and 6% of the request queue is full.’. </div><div> </div><div>或者: </div><div> </div><div>ISAPI ‘C:\WINDOWS\system32\inetsrv\asp.dll’ 报告它自身有问题，原因如下: ‘ASP 不正常，因为执行请求的 100% 被挂起，而且请求队列已经使用了 0%。’。 </div><div> </div><div>解决方法: </div><div> </div><div>1.asp是否正确映射到’C:\WINDOWS\system32\inetsrv\asp.dll’ </div><div> </div><div>2.一般来讲,是由于在同属IIS的应用程序池出现了某个站ASP代码错误所致,使得内存耗尽,检查代码本身的问题.可以隔离到单独应用程序池调试 </div><div> </div><div>3、减少应用程序池回收时间。默认为：1740。。可设为120（每2小时） </div><div> </div><div>IIS假死的原因： </div><div> </div><div>打开IIS 你就会看到应用程序池，默认只有一个应用程序池，查看应用程序池的属性，会发现他的回收时间，默认多达，1740分钟，就是说，需要在1740分钟后才回收此应用程序池，如果在这个时间内，达到请求的最高限制，那么就会出现ASP假死的情况，这个就是大型网站出现假死的情况，反而，小型网站确不会出现这样的情况，因为他请求少，流量少，还没达到限制数量。当然要看你的服务器上网站数目而定。 </div><div> </div><div>以下是解决方法: </div><div> </div><div>资料一 </div><div> </div><div>单个网站解决方法: </div><div> </div><div>把应用程序池回收时间缩短到300-600分钟，其间回收过程中，需要占用一点CPU资源，没办法，为了稳定性，再把回收时间设为凌晨5点。 </div><div> </div><div>多网站解决方法： </div><div> </div><div>我的服务器目前拉了70个网站左右，我新建六个应用程序池，把每个池回收时间缩小到300分钟，然后再分配每个池10个网站左右(这个分配是要求你的网站访问量所定)如果某个网站，访问量大，就单独给他一个程序池，但是这样做的后果就是需要大内存，一个池现在占用我120M内存左右，反正内存大，没关系， </div><div> </div><div>那么多网站如何分配应用程序池，打开IIS–查看你要分配的网站属性，，查看主目录–在下面你就会看到应用程序池了，分配一个就行了。 </div><div> </div><div>资料二 </div><div> </div><div>大家在使用iis6时..如果装了动网论坛.肯定有出现过iis6假死现像..就是asp网页打开慢..但是iis却是正常的..静态网页打开速度一样..这时候..我一直是重启的方法..查了官方的资料结果没有…据官方资料说..win2003很快就要打这个补丁了..是iis6对access驱动支持不理像..也算是一个bug吧..由于我的服务器虚拟主机多..而且大多支持asp..如果一旦假死就无法运行..在多方面的资料查找下..找到了一个比较简单的方法..具体我测试是通过了..iis6自带数据应用程序池..现在就利用他来解决假死.. </div><div> </div><div>首先把bbs设一个单独的目录..然后点击应用程序池..新建应用程序池.输入应用程序池id.. </div><div> </div><div>然后把bbs的虚拟目录下面的.就用程序池..选择刚才新建的应用程序池… </div><div> </div><div>然后再回到刚才设好的应用程序池…点击..属性…把回收工作进程数(分钟)及回收工作进程数还有在下列时间回收时间进程勾上..然后在下列时间回收程序池里左边添加..选择一个时间..一般来说..网站到凌晨3点的时候.基本人都很少了..这时回收一下bbs的进程数..就可以解决了iis假死的现像.. </div><div> </div><div>当然还可以配置其他信息..比如说iis6的用户名.. 我们可以打开计处机管理..然后打开计算机用户管理..添加一个用户..设置好后..在应用程序池里面..标识..把添加的用户放上去..用用户来测试回收的进程..当然还有..其他配置..其实很简单..只要你好好看一下..就能明白意思… </div><div> </div><div>对于我来说..这种方法可能不太方便..所以我用一个工具来回收应用程序池..这样方便而且快捷..个人用户当然不需要这种工具..我是公司工作..服务器压力挺大..所以都用工具来解决一些问题.所括.iis的备分.及虚拟主机ip的统一修改及端口访问的ip记录..用批处理是一个很简单又方便的方法.所以.把一台服务器做的安全..并不是哪么容易的事..特别是iis..经常去官方网站搜索资料是一个好习惯..还有就是经常性的访问日志..及注册表的用户还有加载运行的程序.及服务也是一个好方法..所以.要学会如何遇到问题如何处理问题!!!! </div><div> </div><div>微软关于该问题的解释： </div><div>http://support.microsoft.com/default.aspx?scid=kb;en-us;828222</div>