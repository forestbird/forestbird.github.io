---
id: 62
title: 'FreeBsd安裝 更新ports 的简单方法'
date: '2016-12-08T23:11:06+08:00'
author: forestbird
layout: post
guid: 'https://bird.work/?p=62'
permalink: /2016/12/08/freebsdan-gengxinports-dejiandanfangfa/
categories:
    - log
tags:
    - FREEBSD
    - install
    - ports
---

 FreeBsd 更新ports 的简单方法

<div> </div><div>以下就是portsnap的几种简单用法：</div><div> </div><div> * 第一次使用可以：portsnap fetch extract</div><div> * 以后使用只要：portsnap fetch update </div><div> * 放在cron里运行：portsnap cron</div><div><span style="font-family: tahoma, arial, 宋体;">另外：</span>  
<span style="font-family: tahoma, arial, 宋体;">更新ports后，如果运行make search name=xxx不成功，请在/usr/ports下运行make fetchindex。</span></div><div> </div><div> </div><div>感觉FreeBSD 6.0最方便的改进就是增加了portsnap这个很方便的升级port tree软件，</div><div>以前用恼人的portupgrade做port tree升级的时候总是感觉有点缺陷，方便性不够，</div><div>而且做成crontab总是担心。</div><div>现在FreeBSD 6.0下有了portsnap这个方便的工具，升级port tree就十分方便。</div><div> </div><div>以下就是portsnap的几种简单用法：</div><div>第一次使用可以：portsnap fetch extract</div><div>以后使用只要：portsnap fetch update </div><div>放在cron里运行：portsnap cron</div><div> </div><div>以下对比是portgrade的麻烦几步：</div><div>/usr/ports/sysutils/portgrade/make install clean</div><div>/usr/ports/net/cvsup/cvsup-without-gui/make install clean</div><div>vi ports-supfile</div><div>cvsup -g -L 2 ports-supfile</div><div>portsdb -Uu</div><div>pkgdb -F</div><div>portupgrade -acCv</div><div> portsnap的服务器列表配置文件在/etc/portsnap.conf只要修改SERVERNAME=这个选项可以用离你最近的portsnap服务器。</div><div> portsnap真的十分方便，用FreeBSD 6.0的朋友们都用portsnap来升级port tree吧，一起丢弃麻烦的portupgrade。</div><div> </div><div> </div><div>地址: portsnap.hshh.org</div><div>使用方法: </div><div>/etc/portsnap.conf 里面更改</div><div>SERVERNAME=portsnap.hshh.org</div><div>portsnap简介: </div><div>portsnap从6.0开始引进系统，给与用户方便的更新系统ports </div><div>portsnap的命令比较少 </div><div>fetch 获取数据 </div><div>extract 释放全部ports </div><div>update 更新ports </div><div>第一次使用可以 portsnap fetch extract </div><div>以后使用可以 portsnap fetch update </div><div>如果写在cron可以用 portsnap cron update</div><div> </div><div> </div><div> </div><div> </div><div>Freebsd 下如何最有效率的安装软件</div><div>FreeBSD的默认下载工具是fetch，既慢又不好用。在FreeBSD下安装软件有一些很有效率的方式，下面就给大家介绍一下。</div><div> </div><div>Ports机制</div><div> </div><div>首先，FreeBSD下最有特色的软件安装和升级机制就是ports，既方便又高效。下面我们从ports套件的安装开始讲起，让你细致的了解有关ports的每一个细节</div><div> </div><div>一、ports套件的安装</div><div> </div><div>①我的FreeBSD 8.0-release是最小化安装，所以既没有ports，也没有/usr/ports目录。选择启用ports的话，需要在root下输入"sysinstall"来安装它：</div><div> </div><div>输入sysinstall –&gt; 选择Configure –&gt; Distributions –&gt; ports，然后安装即可。</div><div> </div><div>②ports的默认路径是/usr/ports。这个ports的根目录下面有很多的文件夹及子文件夹，组成一个树状目录，包含大量ports下的软件。比如mail是邮件服务软件，games是游戏，www代表web服务软件，databases则是数据库软件。</div><div> </div><div>[root@bsd01 /usr/ports]# cd www</div><div>[root@bsd01 /usr/ports/www]# ls -d apache*</div><div>apache-contrib apache13 apache13-modssl+ipv6</div><div>apache-forrest apache13+ipv6 apache13-ssl</div><div>apache-jserv apache13-modperl apache20</div><div>apache-mode.el apache13-modssl apache22</div><div>如果你需要安装什么软件，只要进入当前目录，然后“make install clean”即可。</div><div> </div><div>[root@bsd01 ~]# cd /usr/ports/www/apache22</div><div>[root@bsd01 /usr/ports/www/apache22] make install clean</div><div>/usr/ports/distfiles是存放软件包的文件夹。ports会先检查/usr/ports/distfiles目录内有没有这个软件包，如果没有它就会自动从网上下载安装。</div><div> </div><div>二、加速ports的升级速度</div><div> </div><div>ports从网上下载软件包自动安装，那么从那里下载呢？首先，我们需要安装axel来取代默认的下载工具fetch，这样可以提高ports的安装速度：</div><div> </div><div>cd /usr/ports/ftp/axel</div><div>make install</div><div>然后，我们需要一个源地址管理。跟ubuntu上的/etc/source.list文件一样，freebsd用的文件是/etc/make.conf，我们可以修改其文件，达到加速下载的目的。</div><div> </div><div>\#修改 /et/make.conf</div><div>vi /etc/make.conf</div><div>\#加入以下内容</div><div>FETCH_CMD=axel</div><div>FETCH_BEFORE_ARGS= -n 10 -a</div><div>FETCH_AFTER_ARGS=</div><div>DISABLE_SIZE=yes</div><div>MASTER_SITE_OVERRIDE?=\</div><div>http://ports.hshh.org/${DIST_SUBDIR}/\</div><div>http://ports.cn.freebsd.org/${DIST_SUBDIR}/\</div><div>ftp://ftp.freeBSDchina.org/pub/FreeBSD/ports/distfiles/${DIST_SUBDIR}/</div><div>MASTER_SITE_OVERRIDE?=${MASTER_SITE_BACKUP} </div><div>这样处理后，在公司的网络环境下，FreeBSD的下载速度明显提高了，有时居然能达到1M/s,这样升级及安装软件方便极了；呵呵，终于可以摆脱fetch的龟速了。</div><div> </div><div>三、更新ports目录树</div><div> </div><div>既然ports的树目录全部下载到本地，那么即使FreeBSD有新的软件包或者添置了新的软件，本地目录树也不会更新。所以，我们每隔一段时间需要更新本地目录树。我来介绍一种在FreeBSD中方便、快捷的更新ports的方法：使用portsnap来更新ports目录树。</div><div> </div><div>①配置portsnap：</div><div> </div><div>我们使用portsnap，首先要设置一下它的配置文件，位于/etc/portsnap.conf:</div><div> </div><div>[root@bsd01 /usr/ports]# vi /etc/portsnap.conf</div><div>把</div><div> </div><div>SERVERNAME=portsnap.freebsd.org</div><div> </div><div>修改成：</div><div> </div><div>SERVERNAME=portsnap.hshh.org</div><div> </div><div>这个是他的更新服务器。另外还有几个国内比较快的portsnap服务器：</div><div> </div><div>portsnap.hshh.org</div><div> </div><div>portsnap2.hshh.org</div><div> </div><div>portsnap3.hshh.org (网通)</div><div> </div><div>portsnap4.hshh.org</div><div> </div><div>②首次使用portsnap：</div><div> </div><div>在你的FreeBSD首次使用portsnap必须执行下面2步：</div><div> </div><div>[root@bsd01 ~]# portsnap fetch</div><div>[root@bsd01 ~]# portsnap extract</div><div>portsnap fecth是从网上获取portsnap快照的最新压缩包，听闻这个压缩包官方没小时更新一次。</div><div> </div><div>portsnap extract 则是把这个压缩包创立到/usr/ports。哪怕你以前已经手工安装了ports，他也会重新创立一次。</div><div> </div><div>（注：这2步可以合成使用，指令为 [root@bsd01 ~]# portsnap fetch extract）</div><div> </div><div>③以后使用portsnap更新，只需要执行下面2步：</div><div> </div><div>[root@bsd01 ~]# portsnap fetch</div><div>[root@bsd01 ~]# portsnap update</div><div>同样，这2步可以合成使用：[root@bsd01 ~]# portsnap fetch update</div><div> </div><div>portsnap第一次运行extract命令时，可能需要一段时间，以后更新使用update的时候，速度就快很多了。</div>